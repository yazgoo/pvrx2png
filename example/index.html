<meta charset="UTF-8">
<script>
var Module;
if (!Module) Module = eval('(function() { try { return Module || {} } catch(e) { return {} } })()');
Module['noInitialRun'] = true;
Module['postRun'] = function() {
    console.log('done.....');
}
function pvrx2png(name, text)
{
    output_name = name.substr(0, name.lastIndexOf(".")) + ".png";
    output = FS.createDataFile('/', output_name, "", true, true);
    FS.createDataFile('/', name, text, true, true);
    console.log(output.contents);
    Module.callMain([name]);
    console.log(output);
    return output.contents;
}
</script>
<script src=../bin/pvrx2png.js></script>
<input type=file id=input />
<br/>
<image src="" id=image />
<script>
var input = document.getElementById("input");
var image = document.getElementById("image")
input.addEventListener('change', function(e) {
        var file = input.files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
            var bytes = pvrx2png(file.name, reader.result);
            for(i in bytes)
                if(bytes[i] < 0) bytes[i] += 256
            console.log(bytes);
            image.src = "data:image/png;base64," +
                btoa(String.fromCharCode.apply(null, bytes));
        }
        reader.readAsText(file);    
        });
</script>
